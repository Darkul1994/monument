
> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (73ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    1) should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (817ms)
  3 pending
  1 failing

  1) Send Tests
       should return brotli compressed results if brotli header is sent:

      Uncaught AssertionError: expected '""' to equal '{"type":"Buffer","data":[139,28,128,123,34,116,105,116,108,101,34,58,34,84,111,109,32,83,97,119,121,101,114,34,44,34,65,117,116,104,111,114,34,58,34,83,97,109,117,101,108,32,76,97,110,103,104,111,114,110,101,32,67,108,101,109,101,110,115,34,125,3]}'
      + expected - actual

      -""
      +{"type":"Buffer","data":[139,28,128,123,34,116,105,116,108,101,34,58,34,84,111,109,32,83,97,119,121,101,114,34,44,34,65,117,116,104,111,114,34,58,34,83,97,109,117,101,108,32,76,97,110,103,104,111,114,110,101,32,67,108,101,109,101,110,115,34,125,3]}
      
      at brotli.compress (utils/send_test.js:158:16)
      at TransformStreamEncode.<anonymous> (node_modules/iltorb/index.js:146:5)
      at endReadableNT (_stream_readable.js:974:12)
      at _combinedTickCallback (internal/process/next_tick.js:80:11)
      at process._tickCallback (internal/process/next_tick.js:104:9)




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (775ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (40ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in (62ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (42ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (878ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (654ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (600ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (49ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in (44ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      1) should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       compression routes
         should serve a file as a response with brötli compression:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (664ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (617ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (665ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (39ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (691ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      1) should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       static file routes
         should have a vary:accept-encoding header for static resources:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (560ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (40ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      1) should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       compression routes
         should return status code 200 for valid gzip compression:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (51ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      1) should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       compression routes
         should emit served static events for files with deflate compression:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (703ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (689ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (581ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      1) should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       compression routes
         should have a content-encoding:gzip header for gzip compression:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (641ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (591ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (686ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in (43ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    1) should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (809ms)
  3 pending
  1 failing

  1) handleStaticFile Tests
       should handle the HEAD to a static file:
     Uncaught Error: not implemented
      at Writable._write (_stream_writable.js:461:6)
      at doWrite (_stream_writable.js:333:12)
      at writeOrBuffer (_stream_writable.js:319:5)
      at Writable.write (_stream_writable.js:245:11)
      at ReadStream.ondata (_stream_readable.js:555:20)
      at readableAddChunk (_stream_readable.js:176:18)
      at ReadStream.Readable.push (_stream_readable.js:134:10)
      at onread (fs.js:2018:12)
      at FSReqWrap.wrapper [as oncomplete] (fs.js:683:17)




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (47ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in (44ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission (38ms)
    ✓ should parse out a application/x-www-form-urlencoded submission (46ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent (44ms)
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      1) should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       compression routes
         should emit served static events for files with deflate compression:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (584ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (44ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (733ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (696ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission (47ms)
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    1) should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (889ms)
  3 pending
  1 failing

  1) handleStaticFile Tests
       should handle the HEAD to a static file:
     Uncaught Error: not implemented
      at Writable._write (_stream_writable.js:461:6)
      at doWrite (_stream_writable.js:333:12)
      at writeOrBuffer (_stream_writable.js:319:5)
      at Writable.write (_stream_writable.js:245:11)
      at ReadStream.ondata (_stream_readable.js:555:20)
      at readableAddChunk (_stream_readable.js:176:18)
      at ReadStream.Readable.push (_stream_readable.js:134:10)
      at onread (fs.js:2018:12)
      at FSReqWrap.wrapper [as oncomplete] (fs.js:683:17)




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (45ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (41ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      1) should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       static file routes
         should return a 304 for a valid etag match:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (43ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (776ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (671ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      1) should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      2) should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  314 passing (5s)
  3 pending
  2 failing

  1) Route Handler Tests
       static file routes
         should return a 304 for a valid etag match:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  

  2) Route Handler Tests
       compression routes
         should have a content-encoding:deflate header for deflate compression:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (805ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates (39ms)

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (852ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (56ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (762ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      1) should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       static file routes
         should return a 304 for a valid etag match:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (57ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (47ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (1s)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (43ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in (168ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in (80ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files (43ms)

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (3s)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (50ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in (40ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission (58ms)
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (1s)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (40ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (718ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (73ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in (48ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (45ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (1s)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (42ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (884ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (50ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (1s)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (38ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (935ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run (57ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in (47ms)
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission (47ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (1s)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission (41ms)
    ✓ should parse out a application/x-www-form-urlencoded submission (50ms)
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (827ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (913ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (796ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  316 passing (637ms)
  3 pending


> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      ✓ should return a 304 for a valid etag match
      1) should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       static file routes
         should return just headers if a head request is sent:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  




> monument@3.2.8 mocha /Users/designfrontier/projects/monumentjs
> mocha -- *_test.js bin/*_test.js utils/**/*_test.js web-sockets/**/*_test.js security/**/*_test.js routes/**/*_test.js



  The main monument tests
    ✓ should be correctly defined
    Parser Tests
      ✓ should have a parser method
    Wrapper Tests
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 9999
      ✓ should return a server when run
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and no port passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return a server when run and compress passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an http2 server when http2 and correct params are passed in
Cleaned up old compressed files...
Compiling all doT templates...
Compiling example.jst to file
etags setup...
monument v3.2.8 up and running on port: 3000
      ✓ should return an spdy server when spdy and correct params are passed in
    doTjs Tests
      - should use doTjs defaults if none are set
      - should override doTjs specified defaults when set
      - should ignore irrelevant config keys
    uuid tests
      ✓ should have a createUUID function
      ✓ should return a uuid when called
      ✓ should not return the same uuid when called multiple times

  increment tests
    ✓ should be a function
    ✓ should increment only patch when incrementing patch
    ✓ should increment minor and roll patch when incrementing minor
    ✓ should increment major and roll minor and patch when incrementing major

  config Tests
    ✓ should return an object
    ✓ should set smart defaults
    config.get tests
      ✓ should return the whole config option when called with no value
      ✓ should return the value if a key is passed in
    config.set tests
      ✓ should accept an object of settings
      ✓ should accept a key value pair of a setting
      ✓ should return the configObject after setting
      ✓ should merge defaults in objects
      ✓ should not merge defaults in objects if value is not object

  Utils Tests
    ✓ should return an object that has a send and getCompression functions
    getCompression tests
      ✓ should return deflate if the deflate header is passed in
      ✓ should return gzip if gzip is in the header passed in
      ✓ should return br if brotli is in the header passed in
      ✓ should return gzip if both gzip and deflate are in the header
      ✓ should return brotli if brotli, gzip and deflate are in the header
      ✓ should return none if no header is passed in
      ✓ should return none if an empty header is passed in
      ✓ should return none if compression is turned off no matter what the header is
      ✓ should return correct compression if compression is not in the config
    send tests
      ✓ should have a send function
    setup tests
      ✓ utils should have a setup function
Compiling all doT templates...
etags setup...
      ✓ utils should log info about statsd

  parseForm Tests
    ✓ should return a function 
    ✓ should parse a form string out correctly
    ✓ should return an empty object if no form string

  Parser Tests
    ✓ should return a function
    ✓ should parse out a multipart/form-data submission
    ✓ should parse out a application/x-www-form-urlencoded submission
    ✓ should parse out a json post/put/update
    ✓ should error on an invalid json post/put/update
    ✓ should error on an invalid json post/put/update and emit the error:parse event
    ✓ should parse out a json post/put/update without the correct header
    ✓ should place the parsed elements in body
    ✓ should handle parse errors correctly when they occur
    ✓ should parse out uploaded files

  Redirect Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should raise a 500 error event if no url is passed
    ✓ should default to 307 for just an url passed
    ✓ should allow a statusCode to be passed in
    ✓ should return an empty body if 'HEAD' request and specified type
    ✓ should return an empty body if 'HEAD' request and no type

  Send Tests
    ✓ should be defined as a function
    ✓ should return a function
    ✓ should handle an empty data object
    ✓ should handle a string
    ✓ should handle an object
    ✓ should handle a buffer
    ✓ should handle an array
    ✓ should handle a number and other weird data
    ✓ should handle a bool
    ✓ should return deflate compressed results if deflate header is sent
    ✓ should return gzip compressed results if gzip header is sent
    ✓ should return brotli compressed results if brotli header is sent
    ✓ should return a 304 if the content has not changed

  setStatus function of response object
    ✓ should be defined as a function
    ✓ should return a the response object
    ✓ should set data by a string that is an http status message
    ✓ should set data by a number that is an http status code
    ✓ should not set data by a string that is not http status message
    ✓ should not set data by a number that is not http status code
    ✓ should return the response object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return resonse Object if values are set by status message string
    ✓ should return response object if values are set by status message code
    ✓ should return response object for string "Bad Request"
    ✓ should return response object for status code 400
    ✓ should set data for string "Bad Request"
    ✓ should set data for status code 400
    ✓ should return resonse object for string "Internal Server Error"
    ✓ should return resonse object for status code 500
    ✓ should set data for string "Internal Server Error"
    ✓ should set data for status code 500

  compile Tests
Compiling all doT templates...
Compiling all doT templates...
    ✓ should allow to change dot template settings

  setup Tests
    ✓ should be an object of setup functions
etags setup...
    ✓ should setup listeners for etags
    Delete Old Compressed Files
      ✓ should setup templates

  Static File Etags
ETAG:  "124-NQ5cE7p8kUtC3DwDeGq42vlSmE8"
    ✓ should be able to add a file's etag and return it through events
    ✓ should be able to check a file's etag and say if it is valid
    ✓ should be able to udpate a file's etag
    ✓ should raise an error if the file is not there

  statsd Tests
    ✓ should return an object
    ✓ statsd.create should return StatsD object

  Tools Tests
    ✓ should return an object
    .isDefined tests
      ✓ should return false it the item is undefined
      ✓ should return true it the item is defined
    .isUndefined tests
      ✓ should return true it the item is undefined
      ✓ should return false it the item is defined
    .not tests
      ✓ should return false if true is passed to it
    .contains tests
      ✓ should be a function
      ✓ should return true if it is in the array
      ✓ should return false if it is not in the array

  parseUrl
    ✓ should return a parse function
    parse Tests
      ✓ should behave itself without request parameters
      ✓ should not dork with single value query parms that don't have square brackets
      ✓ should combine query params and remove square brackets
      ✓ should create a single element array even when only a single value exists
      ✓ should remove square brackets on a single parm with a comma delimited value
      ✓ should combine query parms that are not using square brackets
      ✓ should combine query parms that inconsistently use [] convention with [] last
      ✓ should combine query parms that inconsistently use [] convention with [] first
      ✓ should combine multiple query parms that use comma delimited values

  WebSocket handler Tests
    Web Socket Handler Type: false tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should not emit events for non-data event messages
    Web Socket Handler Type: true tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should pass message and socket through to data new events
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should emit error:ws when error is occuring
    Web Socket Handler Type: data tests
      ✓ should be a function and return a function
      ✓ should emit events for data event messages
      ✓ should not emit events for non-data event messages
      ✓ should not emit events for invalid JSON data
      ✓ should return a string when responding to a socket
    Web Socket Handler Type: passthrough tests
      ✓ should be a function and return a function
      ✓ should not emit events for data event messages
      ✓ should emit events for non-data event messages
      ✓ should pass the message and socket through to passthrough events
      ✓ should pass message and socket through to data new events

  content security policy
    ✓ returns a function
    ✓ should have a flushCache function
    ✓ sets headers by string
    ✓ is turned off by passing false
    ✓ sets default-src to self by default
    ✓ sets all the headers if you tell it to
    ✓ sets all the headers if you provide an unknown user-agent
    ✓ sets the report-only headers
    ✓ can set empty directives
    ✓ throws an error when directives need quotes
    ✓ throws an error reportOnly is true and there is no report-uri
    ✓ sets the header properly for Firefox 23
    ✓ sets the header properly for Chrome 24
    ✓ sets the header properly for Chrome 27
    ✓ sets the header properly for Opera 15
    ✓ sets the header properly for Opera 21
    ✓ sets the header properly for Safari 6
    ✓ sets the header properly for Safari 7
    ✓ sets the header properly for Internet Explorer 7
    ✓ sets the header properly for Internet Explorer 8
    ✓ sets the header properly for Internet Explorer 9
    ✓ sets the header properly for Internet Explorer 9 on Xbox 360
    ✓ sets the header properly for Internet Explorer 10
    ✓ sets the header properly for Internet Explorer 10 on Xbox One
    ✓ sets the header properly for Internet Explorer 11 on Windows 7
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with Enterprise Mode
    ✓ sets the header properly for Internet Explorer 11 on Windows 8.1 with compatibility view
    ✓ sets the header properly for Internet Explorer 11 on Windows Phone 8.1
    ✓ sets the header properly for Microsoft Edge on Windows 10
    ✓ sets the header properly for Microsoft Edge on Windows Phone
    ✓ sets the header properly for Android 4.4.3
    ✓ sets the header properly for Firefox 22
    ✓ sets the header properly for Firefox 4.0
    ✓ does not set the property for Safari 4.1 by default
    ✓ does not set the property for Safari 5.1 on OS X by default
    ✓ does not set the property for Safari 5.1 on Windows Server 2008 by default
    ✓ does not set the property for Chrome 13 by default
    ✓ does not set the property for Firefox 3 by default
    ✓ does not set the property for Android Browser 4.0.3 by default
    ✓ does not set the property for Opera 12.16 by default
    ✓ sets the header for Safari 4.1 if you force it
    ✓ sets the header for Safari 5.1 if you force it
    ✓ lets you disable Android
    ✓ appends connect-src 'self' in iOS Chrome when connect-src is already defined
    ✓ adds connect-src 'self' in iOS Chrome when connect-src is undefined
    ✓ does nothing in iOS Chrome if connect-src 'self' is defined
    ✓ doesn't splice the original array
    ✓ should not blow up if a string is passed instead of an array of options

  frameguard
    ✓ returns a function
    with proper input
      ✓ sets header to SAMEORIGIN with no arguments
      ✓ sets header to DENY when called with lowercase "deny"
      ✓ sets header to DENY when called with uppercase "DENY"
      ✓ sets header to SAMEORIGIN when called with lowercase "sameorigin"
      ✓ sets header to SAMEORIGIN when called with uppercase "SAMEORIGIN"
      ✓ sets header properly when called with lowercase "allow-from"
      ✓ sets header properly when called with uppercase "ALLOW-FROM"
    with improper input
      ✓ fails with a bad first argument
      ✓ fails with a bad second argument if the first is "ALLOW-FROM"

  Security Headers: Strict-Transport-Security Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should set a header with a different max age if passed in
    ✓ should set a header with a different max age and no includeSubdomains if passed in
    ✓ should set a header with no includeSubdomains if passed in
    ✓ should set a header with no preload if passed in
    ✓ should set a header with a different max age and no preloads if passed in
    ✓ should set a header with a different max age and other options off if passed in
    ✓ should set a header with a default max age and other options off if passed in
    ✓ should not set a header if the config is false
    ✓ should throw an error if a bad value for maxAge is passed in
    ✓ should return res when executed

  Security Headers: no cache!
    ✓ should return a function
    ✓ should not set a header if there is no option in config
    ✓ should set all the headers if the config is true
    ✓ should kill the etag and set all headers if the config.etag is true
    ✓ should return res when executed
    ✓ should add a noCache function to res when executed

  Security Headers: X-Download-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: X-Content-Type-Options Tests
    ✓ should return a function
    ✓ should set a header if there is no option in config
    ✓ should set a header if the config is true
    ✓ should not set a header if the config is false
    ✓ should return res when executed

  Security Headers: x-powered-by Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should set a header if a value for one is in config
    ✓ should return res when executed

  Security Headers: Public-Key-Pin/Public-Key-Pin-Report-Only Tests
    ✓ should return a function
    ✓ should not set a header if there is no option to in config
    ✓ should throw if empty config is passed in
    ✓ should return a header if correct config passed in
    ✓ should return a header if correct config + includeSubdomains passed in
    ✓ should return a header if correct config + includeSubdomains = false passed in
    ✓ should return a header if correct config + reportUri passed in
    ✓ should return a header if correct config + reportUri and reportOnly is passed in
    ✓ should return a header if correct config + reportUri = false passed in
    ✓ should return res when executed

  Security Headers: X-XSS-Protection
    ✓ should return a function
    ✓ should return res when executed
    default behaviors
      ✓ should set the correct header if old IE
      ✓ should set the correct header if IE
      ✓ should set the correct header if new IE
    disabled by config
      ✓ should not set the header if config.security.xssProtection is false

  handleStaticFile Tests
ETAG:  "2c5-voekSImB3wO9ElcF4D0vGLGUgpc"
    ✓ should handle a static file
    ✓ should handle the HEAD to a static file
    ✓ should give 404 for static files missing

  Routing Tests
    ✓ should return a function that starts a server
    ✓ should have a parseWildCardRoute function
    ✓ should have a isWildCardRoute function

  isWildCardRoute Tests
    ✓ should return a function
    ✓ should return true if a wildcard route is passed in
    ✓ should return false if a wildcard route is passed in but the verb mismatches
    ✓ should return false if the route doesn't match any patterns

  matchSimpleRoute Tests
    ✓ should return a function
    ✓ should return null for a simple route
    ✓ should return null for a non-simple route
    ✓ should return null for a simple route and wrong verb
    ✓ should return true for /about
    ✓ should return true for /
    ✓ should not match for /:id
    ✓ should return true for /about/ handling trailing slash

  parseRoutes tests
    ✓ should export a function
    ✓ should return an object containing wildcard and standard routes
    ✓ should return an object containing 2 wildcard routes
    ✓ should return a properly formatted route object for /:id
    ✓ should return an object containing 8 standard routes

  Wildcard route parsing tests
    ✓ should export a function
    ✓ should properly parse a wildcard route

  statsd tests
    when configured
      ✓ sends route and route status to statsd for each request
      ✓ sends route and route status to statsd for each request
      ✓ sends timing information and route with each wildcard request
      ✓ sends timing information and route with each standard request
    when not configured
      ✓ does not send anything to statsd for each standard request
      ✓ does not send anything to statsd for each wildcard request

  Route Handler Tests
    ✓ should be defined as a function
    ✓ should return a function
    simple routes
      ✓ should emit the correct route event for a simple route
    security headers
      ✓ should return x-powered-by only if it is set
      ✓ should by default not return x-powered-by 
    parameterized routes
      ✓ should emit the correct route event for a wildcard route
      ✓ should pass variables on the connection.params from the url
    404 routes
      ✓ should emit the 404 route event for a 404 route
    static file routes
      ✓ should emit 404 & missing static events for missing file in sub of public
      ✓ should emit 404 event for a non-existant static file in the root of public
ETAG:  "49-MfNalQPJ0EarWoSLWttO6RHVTUI"
      ✓ should return the file for an existing static file with no etag
      ✓ should have a vary:accept-encoding header for static resources
      1) should return a 304 for a valid etag match
      ✓ should return just headers if a head request is sent
    route.json route
      ✓ should return the routes.json file when the router route is requested
    compression routes
      ✓ should return status code 200 for valid gzip compression
      ✓ should have a content-encoding:gzip header for gzip compression
      ✓ should serve a file as a response with gzip compression
      ✓ should emit served static events for files with gzip compression
      ✓ should return status code 200 for valid deflate compression
      ✓ should have a content-encoding:deflate header for deflate compression
      ✓ should serve a file as a response with deflate compression
      ✓ should emit served static events for files with deflate compression
      ✓ should have a content-encoding:br header for brötli compression
      ✓ should serve a file as a response with brötli compression
      ✓ should emit served static events for files with brötli compression

  routeStore Tests
    ✓ should return an object
    #add
      ✓ should add a route to the server
      ✓ should add a verb if the route already exists
      ✓ should do nothing if there is no change
    #get
      ✓ should return the current route object
    #getWildcard
      ✓ should return the current wildcard routes only
    #getStandard
      ✓ should return the current standard routes only
    #remove
      ✓ should remove all if no verbs are passed
      ✓ should remove the whole route if all verbs are passed to it
      ✓ should remove only a verb if a route listens to multiple but one is passed
      ✓ should remove only the verbs passed if a route listens to multiple
      ✓ should do nothing if there is no match
    #parse
      ✓ should parse a routes.json

  The Setup tests
    ✓ should be correctly defined
    ✓ should return the list of public folders
    ✓ should throw if an invalid value for routePath is passed


  315 passing (3s)
  3 pending
  1 failing

  1) Route Handler Tests
       static file routes
         should return a 304 for a valid etag match:
     Error: Timeout of 2000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.
  



